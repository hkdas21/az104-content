<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZ-104 Exam Prep Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .flashcard-container { perspective: 1000px; height: 220px; }
        .flashcard-inner { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            text-align: center; 
            transition: transform 0.6s; 
            transform-style: preserve-3d; 
            cursor: pointer;
        }
        .flashcard-container.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 1.5rem; 
            border-radius: 1rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
        }
        .flashcard-back { transform: rotateY(180deg); }
        
        .view-content { display: none; }
        .view-content.active { display: block; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .donut-ring { transition: stroke-dashoffset 0.5s ease; transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        .module-card:hover { transform: translateY(-4px); transition: all 0.2s ease; }

        /* Quiz Feedback Styles */
        .option-btn.correct { @apply border-green-500 bg-green-50 text-green-700 ring-2 ring-green-200; }
        .option-btn.incorrect { @apply border-red-500 bg-red-50 text-red-700 ring-2 ring-red-200; }
        .option-btn.disabled { @apply opacity-60 cursor-not-allowed; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <!-- Global Header -->
    <nav class="bg-indigo-700 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 class="text-xl font-bold flex items-center gap-2 cursor-pointer" onclick="showView('dashboard')">
                <i data-lucide="graduation-cap"></i> AZ-104 Exam Prep
            </h1>
            <div id="module-nav" class="hidden flex flex-wrap justify-center gap-2">
                <button onclick="showTab('notes')" class="tab-btn px-3 py-1.5 rounded-lg bg-indigo-800 hover:bg-indigo-600 transition active" data-tab="notes">Notes</button>
                <button onclick="showTab('flashcards')" class="tab-btn px-3 py-1.5 rounded-lg hover:bg-indigo-600 transition" data-tab="flashcards">Flashcards</button>
                <button onclick="showTab('quiz')" class="tab-btn px-3 py-1.5 rounded-lg hover:bg-indigo-600 transition" data-tab="quiz">Quizzes</button>
                <button onclick="showView('dashboard')" class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition flex items-center gap-1">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i> Modules
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-8">
        
        <!-- DASHBOARD VIEW -->
        <section id="dashboard-view" class="view-content active space-y-8">
            <header class="text-center space-y-2">
                <h2 class="text-3xl font-extrabold text-slate-800">Microsoft Certified: Azure Administrator Associate</h2>
                <p class="text-slate-500">Select an AZ-104 module to access study notes, flashcards, and practice tests.</p>
            </header>

            <div id="module-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Modules injected via JS -->
            </div>
        </section>

        <!-- UNIFIED MODULE VIEW -->
        <section id="module-view" class="view-content space-y-8">
            <div class="flex items-center gap-4 mb-2">
                <button onclick="showView('dashboard')" class="p-2 rounded-full hover:bg-slate-200 text-slate-600 transition">
                    <i data-lucide="arrow-left"></i>
                </button>
                <h2 id="current-module-title" class="text-2xl font-bold text-slate-800">Module Detail</h2>
            </div>

            <!-- NOTES TAB -->
            <div id="notes" class="tab-content active space-y-6">
                <div id="notes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Notes injected via JS -->
                </div>
            </div>

            <!-- FLASHCARDS TAB -->
            <div id="flashcards" class="tab-content space-y-6">
                <div class="flex justify-between items-center px-2">
                    <p class="text-slate-500 text-sm italic">Click to reveal the answer.</p>
                    <button onclick="flipAllCards()" class="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg font-bold">FLIP ALL</button>
                </div>
                <div id="flashcards-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Cards injected via JS -->
                </div>
            </div>

            <!-- QUIZ TAB -->
            <div id="quiz" class="tab-content space-y-12">
                <div id="quiz-zone-0" class="quiz-zone space-y-4"></div>
                <div id="quiz-zone-1" class="quiz-zone space-y-4"></div>
            </div>
        </section>

    </main>

    <footer class="mt-20 p-8 border-t border-slate-200 text-center text-slate-400 text-sm">
        <p>AZ-104 Exam Preparation Hub &copy; 2026</p>
    </footer>

    <script>
        const modules = [
            { id: 1, name: "Prerequisites for Azure administrators", desc: "Initial tools: Azure portal, Cloud Shell, Azure PowerShell, CLI, and ARM templates.", icon: "wrench", color: "blue" },
            { id: 2, name: "Manage identities", desc: "Microsoft Entra users and groups, managing external users, and configuring SSPR.", icon: "users", color: "indigo" },
            { id: 3, name: "Governance in Azure", desc: "implementing Azure roles, applying Azure policy, and governance controls.", icon: "shield-check", color: "purple" },
            { id: 4, name: "Implement and manage storage", desc: "Access keys, SAS tokens, Azure files, and blob storage implementation.", icon: "database", color: "cyan" },
            { id: 5, name: "Deploy and manage compute resources", desc: "Virtual Machines, App Services, and Container solutions.", icon: "cpu", color: "orange" },
            { id: 6, name: "Configure and manage virtual networks", desc: "VNETs, securing access with NSGs, load balancing, and hybrid connectivity.", icon: "share-2", color: "emerald" },
            { id: 7, name: "Monitor and back up resources", desc: "Azure Monitor, Log Analytics, alerts, and backup solutions.", icon: "activity", color: "rose" }
        ];

        const contentData = {
            3: {
                notes: [{ title: "Governance Basics", items: ["MG tree max 6 levels.", "Subscriptions: Billing unit.", "PIM: Just-in-time access.", "Activity Log: 90 days."] }],
                flashcards: [{ q: "PIM", a: "Privileged Identity Management." }],
                quizzes: [{ title: "Governance Knowledge Check", questions: [
                    { q: "Which component protects against a datacenter failure?", options: ["Regions", "Availability Zones", "Subscriptions", "Resource Groups"], correct: 1, explanation: "Availability Zones are physically separate locations within an Azure region." }
                ]}]
            },
            4: {
                notes: [{ title: "Storage Basics", items: ["LRS: 3 copies 1 DC.", "ZRS: 3 copies 3 Zones.", "Lifecycle: Auto-tiering."] }],
                flashcards: [{ q: "LRS", a: "Locally Redundant Storage." }],
                quizzes: [{ title: "Storage Solutions Quiz", questions: [
                    { q: "What is the minimum copies in LRS?", options: ["1", "2", "3", "6"], correct: 2, explanation: "LRS maintains 3 copies within one datacenter." }
                ]}]
            },
            5: {
                notes: [{ title: "Compute Basics", items: ["AV Set: 99.95% SLA.", "AV Zone: 99.99% SLA.", "VMSS: Horizontal scaling."] }],
                flashcards: [{ q: "KEDA", a: "Kubernetes-based Event Driven Autoscaling." }],
                quizzes: [
                    { title: "Quiz 1: Virtual Machine Architecture", questions: [{ q: "Update Domain purpose?", options: ["Prevent hardware failure", "Manage maintenance reboots", "Scale instances", "Encrypt disks"], correct: 1, explanation: "Update domains ensure maintenance doesn't reboot all VMs at once." }] },
                    { title: "Quiz 2: App Services & Containers", questions: [{ q: "KEDA use case?", options: ["Manual scaling", "Event-driven scaling", "Storage management", "VNET peering"], correct: 1, explanation: "KEDA is for event-driven autoscaling in Container Apps/K8s." }] }
                ]
            },
            6: {
                notes: [
                    { title: "Virtual Network Basics", items: ["Azure reserves 5 IP addresses in every subnet (.0, .1, .2, .3, .255).", "RFC 1918 Private ranges: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16.", "VNets cannot overlap if you intend to peer them."] },
                    { title: "Security & Rules", items: ["NSG (Network Security Group): Layer 4 (TCP/UDP) filtering. Priority 100-4096.", "ASG (Application Security Group): Logical group for VMs to simplify NSG rules (e.g. 'WebServers' group).", "Service Endpoints: Secure access to Azure services over the backbone."] },
                    { title: "Connectivity", items: ["Peering: Connecting VNets (Local or Global). Non-transitive by default.", "UDR (User Defined Routes): Override system routes to force traffic through NVAs.", "Next Hop types: Virtual Appliance, VNet Gateway, Internet, None."] }
                ],
                flashcards: [
                    { q: "Azure Reserved IPs", a: "5 addresses per subnet: Network, Gateway, DNS (2), and Broadcast." },
                    { q: "NSG Priority", a: "100 to 4096. Lower numbers have higher priority." },
                    { q: "VNet Peering", a: "Connecting VNets via Microsoft backbone. Low latency, high bandwidth." },
                    { q: "UDR", a: "User Defined Routes used to control traffic flow (e.g., through a Firewall)." },
                    { q: "ASG", a: "Application Security Groups used to simplify NSG rules based on VM roles." }
                ],
                quizzes: [
                    { 
                        title: "Networking & Traffic Management", 
                        questions: [
                            { q: "How many IP addresses does Azure reserve in a /24 subnet (256 addresses total)?", options: ["2", "3", "5", "8"], correct: 2, explanation: "Azure always reserves 5 IP addresses in every subnet: .0 (Network), .1 (Gateway), .2/.3 (DNS), and .255 (Broadcast)." },
                            { q: "What is the priority range for Network Security Group (NSG) rules?", options: ["1-1000", "100-4096", "0-65535", "10-100"], correct: 1, explanation: "NSG rules have a priority range from 100 to 4096. Lower numbers are processed first." },
                            { q: "You want to group several VMs as 'WebServers' so you can use that name in NSG rules instead of individual IP addresses. Which feature should you use?", options: ["Load Balancer", "Application Gateway", "Application Security Group (ASG)", "Service Endpoints"], correct: 2, explanation: "ASGs allow you to define network security policies based on workloads, rather than explicit IP addresses." },
                            { q: "By default, is VNet Peering transitive? (If A is peered with B, and B with C, can A talk to C?)", options: ["Yes", "No", "Only if in the same region", "Only for Standard VNets"], correct: 1, explanation: "VNet peering is non-transitive. To allow A to talk to C through B, you would need to set up a Gateway Transit or a hub-and-spoke NVA." },
                            { q: "Which tool should you use to force all traffic from a subnet to pass through a central Firewall appliance?", options: ["NSG", "User Defined Route (UDR)", "Load Balancer", "Service Endpoint"], correct: 1, explanation: "UDRs allow you to override system routes by defining a 'Next Hop' of 'Virtual Appliance'." },
                            { q: "What is the 'Next Hop' type used in a UDR to effectively black-hole or drop traffic?", options: ["None", "Virtual Appliance", "Internet", "VNet Gateway"], correct: 0, explanation: "A next hop of 'None' causes any traffic matching that route to be dropped." },
                            { q: "At which OSI layer does the Azure Load Balancer operate?", options: ["Layer 2", "Layer 3", "Layer 4", "Layer 7"], correct: 2, explanation: "Azure Load Balancer is a Layer 4 (TCP/UDP) load balancer." },
                            { q: "Which Azure load balancing solution supports URL path-based routing and SSL termination?", options: ["Azure Load Balancer", "Application Gateway", "Traffic Manager", "Azure Front Door"], correct: 1, explanation: "Application Gateway is a Layer 7 load balancer that handles HTTP/HTTPS traffic, including path-based routing." },
                            { q: "What is the maximum number of VNets you can peer with a single VNet by default?", options: ["10", "50", "500", "Unlimited"], correct: 1, explanation: "The default limit is 50, though it can be increased. (Note: Exam often focuses on the concept of peering constraints)." },
                            { q: "Which Load Balancer SKU is required if you want to balance traffic across multiple Availability Zones?", options: ["Basic", "Standard", "Premium", "Ultra"], correct: 1, explanation: "Only the Standard Load Balancer supports Availability Zones (Zonal or Zone-Redundant)." },
                            { q: "You need to secure access to an Azure SQL Database so it only accepts traffic from a specific VNet subnet. Which feature is most appropriate?", options: ["VNet Peering", "Service Endpoints", "UDR", "ASG"], correct: 1, explanation: "Service Endpoints provide secure and direct connectivity to Azure services over the Microsoft backbone." },
                            { q: "Which Application Gateway feature protects web applications from common vulnerabilities like SQL injection or Cross-site scripting?", options: ["SSL Offloading", "Web Application Firewall (WAF)", "Multi-site hosting", "Cookie-based affinity"], correct: 1, explanation: "The WAF provides centralized protection for web applications from common exploits." },
                            { q: "What is the default behavior if two peered VNets have overlapping IP address ranges?", options: ["They merge ranges", "Peering fails/cannot be established", "Only the smaller range wins", "Azure automatically NATs them"], correct: 1, explanation: "VNets with overlapping address spaces cannot be peered." },
                            { q: "Which component of an Azure Load Balancer monitors the health of the backend VMs?", options: ["Inbound NAT rule", "Health Probe", "Backend Pool", "Frontend IP"], correct: 1, explanation: "Health probes determine which backend instances are healthy enough to receive traffic." },
                            { q: "To allow traffic from the internet to a VM behind an NSG, which default rule might you need to override with a higher priority rule?", options: ["AllowVNetInbound", "AllowAzureLoadBalancerInbound", "DenyAllInbound", "AllowInternetOutbound"], correct: 2, explanation: "DenyAllInbound is a default rule with priority 65500. You must create a rule with a lower number (higher priority) to allow traffic." },
                            { q: "What is Global VNet Peering?", options: ["Connecting VNets in the same region", "Connecting VNets across different Azure regions", "Connecting Azure to AWS", "Connecting to on-premises"], correct: 1, explanation: "Global peering connects VNets in different Azure regions." },
                            { q: "Which distribution mode does the Azure Load Balancer use by default?", options: ["Round Robin", "5-tuple hash (Source IP, Port, Dest IP, Port, Protocol)", "Least Connections", "URL Path"], correct: 1, explanation: "The default is a 5-tuple hash to map traffic to available servers." },
                            { q: "Can an Application Gateway be used for non-HTTP traffic, such as legacy SQL traffic on port 1433?", options: ["Yes", "No", "Only if SSL is used", "Only with WAF enabled"], correct: 1, explanation: "No, Application Gateway is strictly for Layer 7 (HTTP/HTTPS/HTTP2/WebSocket) traffic. Use Load Balancer for port 1433." },
                            { q: "What is 'Gateway Transit' in the context of VNet Peering?", options: ["Allowing a peered VNet to use the VPN/ExpressRoute gateway of the other VNet", "Allowing peering across regions", "Encrypting the peering traffic", "Speeding up the connection"], correct: 0, explanation: "Gateway transit allows one VNet to 'share' its gateway with its peered neighbors." },
                            { q: "What is the difference between a Public IP and a Private IP in an Azure VNet?", options: ["Private IPs are for internet access", "Public IPs are reachable from outside Azure; Private IPs are for internal communication", "There is no difference", "Public IPs are cheaper"], correct: 1, explanation: "Public IPs allow resources to communicate with the internet; Private IPs are for communication within the VNet or via VPN/Peering." }
                        ]
                    }
                ]
            }
        };

        let currentModuleId = null;
        let activeQuizStates = [];

        function showView(viewId) {
            document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId + '-view').classList.add('active');
            const nav = document.getElementById('module-nav');
            if(viewId === 'dashboard') { nav.classList.add('hidden'); currentModuleId = null; }
            else nav.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('bg-indigo-800', 'text-white'));
            document.getElementById(tabId).classList.add('active');
            const btn = document.querySelector(`[data-tab="${tabId}"]`);
            if(btn) btn.classList.add('bg-indigo-800', 'text-white');
        }

        function openModule(id) {
            currentModuleId = id;
            const module = modules.find(m => m.id == id);
            document.getElementById('current-module-title').innerText = `AZ-104: ${module.name}`;
            loadModuleContent(id);
            showView('module');
            showTab('notes');
        }

        function loadModuleContent(id) {
            const data = contentData[id] || { 
                notes: [{ title: "Under Development", items: ["Study material coming soon."] }],
                flashcards: [{ q: "Ready?", a: "Stay tuned." }],
                quizzes: [{ title: "Coming Soon", questions: [] }]
            };

            document.getElementById('notes-container').innerHTML = data.notes.map(note => `
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h4 class="font-bold text-slate-800 mb-3">${note.title}</h4>
                    <ul class="space-y-2 text-sm text-slate-600">${note.items.map(i => `<li>â€¢ ${i}</li>`).join('')}</ul>
                </div>
            `).join('');

            document.getElementById('flashcards-grid').innerHTML = data.flashcards.map((c, i) => `
                <div class="flashcard-container" id="fc-${i}" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front bg-indigo-600 text-white font-bold text-sm px-4">${c.q}</div>
                        <div class="flashcard-back bg-white border-2 border-indigo-600 text-indigo-900 text-xs font-medium px-4">${c.a}</div>
                    </div>
                </div>
            `).join('');

            activeQuizStates = data.quizzes.map(() => ({ idx: 0, score: 0, attempted: 0, isAnswering: true }));
            renderQuizZones(data.quizzes);
            lucide.createIcons();
        }

        function renderQuizZones(quizzes) {
            const zones = [document.getElementById('quiz-zone-0'), document.getElementById('quiz-zone-1')];
            zones.forEach(z => z.innerHTML = '');
            
            quizzes.forEach((q, i) => {
                const zone = zones[i];
                if (!zone) return;

                zone.innerHTML = `
                    <div id="quiz-start-${i}" class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 text-center space-y-4">
                        <i data-lucide="zap" class="mx-auto w-12 h-12 text-yellow-500"></i>
                        <h2 class="text-xl font-bold">${q.title}</h2>
                        <p class="text-slate-500 text-sm">${q.questions.length} Exam-style Questions</p>
                        <button onclick="startQuiz(${i})" class="px-8 py-3 rounded-xl bg-indigo-700 text-white font-bold">Start This Quiz</button>
                    </div>

                    <div id="quiz-container-${i}" class="hidden grid md:grid-cols-3 gap-6">
                        <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center h-fit">
                            <div class="relative w-32 h-32 mb-4">
                                <svg viewBox="0 0 120 120" class="w-full h-full">
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#f1f5f9" stroke-width="8" />
                                    <circle cx="60" cy="60" r="38" fill="none" stroke="#f1f5f9" stroke-width="8" />
                                    <circle id="ring-attempted-${i}" cx="60" cy="60" r="50" fill="none" stroke="#6366f1" stroke-width="8" stroke-linecap="round" class="donut-ring" stroke-dasharray="314" stroke-dashoffset="314" />
                                    <circle id="ring-correct-${i}" cx="60" cy="60" r="38" fill="none" stroke="#22c55e" stroke-width="8" stroke-linecap="round" class="donut-ring" stroke-dasharray="239" stroke-dashoffset="239" />
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center text-lg font-bold" id="accuracy-text-${i}">0%</div>
                            </div>
                            <div class="w-full text-sm space-y-1">
                                <div class="flex justify-between"><span>Attempted:</span> <span id="stat-attempted-${i}" class="font-bold">0/0</span></div>
                                <div class="flex justify-between text-green-600"><span>Correct:</span> <span id="stat-correct-${i}" class="font-bold">0</span></div>
                            </div>
                        </div>
                        <div class="md:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                            <div class="text-indigo-600 font-bold mb-2 text-sm" id="quiz-progress-text-${i}">Question 1/0</div>
                            <h3 class="text-lg font-bold mb-6" id="quiz-question-${i}">Loading...</h3>
                            <div class="grid gap-2" id="quiz-options-${i}"></div>
                            <div id="quiz-feedback-${i}" class="hidden mt-6 p-4 rounded-xl border animate-in fade-in duration-300">
                                <div class="flex items-center gap-2 mb-2">
                                    <i id="feedback-icon-${i}" class="w-5 h-5"></i>
                                    <span id="feedback-title-${i}" class="font-bold">Explanation</span>
                                </div>
                                <p id="feedback-text-${i}" class="text-sm text-slate-600 leading-relaxed"></p>
                                <button onclick="nextQuestion(${i})" class="mt-4 w-full py-2 bg-indigo-700 text-white rounded-lg font-bold hover:bg-indigo-800 transition">Next Question</button>
                            </div>
                        </div>
                    </div>

                    <div id="quiz-result-${i}" class="hidden bg-white p-8 rounded-2xl shadow-sm border border-slate-200 text-center space-y-4">
                        <h2 class="text-2xl font-bold">Module Result</h2>
                        <div class="text-5xl font-bold text-indigo-700" id="quiz-score-${i}">0/0</div>
                        <button onclick="resetQuiz(${i})" class="px-6 py-2 rounded-lg bg-indigo-700 text-white font-bold">Restart Test</button>
                    </div>
                `;
            });
        }

        function startQuiz(qIdx) {
            document.getElementById(`quiz-start-${qIdx}`).classList.add('hidden');
            document.getElementById(`quiz-container-${qIdx}`).classList.remove('hidden');
            activeQuizStates[qIdx] = { idx: 0, score: 0, attempted: 0, isAnswering: true };
            updateDonut(qIdx);
            showQuestion(qIdx);
        }

        function showQuestion(qIdx) {
            const state = activeQuizStates[qIdx];
            const quizData = contentData[currentModuleId].quizzes[qIdx];
            const curr = quizData.questions[state.idx];
            state.isAnswering = true;

            document.getElementById(`quiz-progress-text-${qIdx}`).innerText = `Question ${state.idx + 1}/${quizData.questions.length}`;
            document.getElementById(`quiz-question-${qIdx}`).innerText = curr.q;
            document.getElementById(`quiz-feedback-${qIdx}`).classList.add('hidden');
            
            const optionsDiv = document.getElementById(`quiz-options-${qIdx}`);
            optionsDiv.innerHTML = '';
            curr.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = `opt-btn-${qIdx} w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-indigo-50 text-sm font-medium transition flex justify-between items-center`;
                btn.innerHTML = `<span>${opt}</span><i class="hidden w-4 h-4"></i>`;
                btn.onclick = () => selectOption(qIdx, i, btn);
                optionsDiv.appendChild(btn);
            });
            lucide.createIcons();
        }

        function selectOption(qIdx, optI, btn) {
            const state = activeQuizStates[qIdx];
            if (!state.isAnswering) return;
            state.isAnswering = false;
            
            const quizData = contentData[currentModuleId].quizzes[qIdx];
            const curr = quizData.questions[state.idx];
            const isCorrect = optI === curr.correct;
            
            state.attempted++;
            if(isCorrect) state.score++;

            const btns = document.querySelectorAll(`.opt-btn-${qIdx}`);
            btns.forEach((b, idx) => {
                b.classList.add('disabled');
                if (idx === curr.correct) {
                    b.classList.add('correct');
                    b.querySelector('i').classList.remove('hidden');
                    b.querySelector('i').setAttribute('data-lucide', 'check');
                } else if (idx === optI && !isCorrect) {
                    b.classList.add('incorrect');
                    b.querySelector('i').classList.remove('hidden');
                    b.querySelector('i').setAttribute('data-lucide', 'x');
                }
            });

            const feedback = document.getElementById(`quiz-feedback-${qIdx}`);
            feedback.classList.remove('hidden');
            document.getElementById(`feedback-title-${qIdx}`).innerText = isCorrect ? "Correct!" : "Incorrect";
            document.getElementById(`feedback-text-${qIdx}`).innerText = curr.explanation;
            feedback.className = `mt-6 p-4 rounded-xl border ${isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}`;
            
            lucide.createIcons();
            updateDonut(qIdx);
        }

        function nextQuestion(qIdx) {
            const state = activeQuizStates[qIdx];
            const quizData = contentData[currentModuleId].quizzes[qIdx];
            state.idx++;
            if(state.idx < quizData.questions.length) showQuestion(qIdx);
            else showQuizResult(qIdx);
        }

        function updateDonut(qIdx) {
            const state = activeQuizStates[qIdx];
            const total = contentData[currentModuleId].quizzes[qIdx].questions.length;
            const outer = 314, inner = 239;
            document.getElementById(`ring-attempted-${qIdx}`).style.strokeDashoffset = outer - (state.attempted/total)*outer;
            document.getElementById(`ring-correct-${qIdx}`).style.strokeDashoffset = inner - (state.score/total)*inner;
            document.getElementById(`stat-attempted-${qIdx}`).innerText = `${state.attempted}/${total}`;
            document.getElementById(`stat-correct-${qIdx}`).innerText = state.score;
            document.getElementById(`accuracy-text-${qIdx}`).innerText = state.attempted ? Math.round((state.score/state.attempted)*100)+"%" : "0%";
        }

        function showQuizResult(qIdx) {
            const state = activeQuizStates[qIdx];
            const total = contentData[currentModuleId].quizzes[qIdx].questions.length;
            document.getElementById(`quiz-container-${qIdx}`).classList.add('hidden');
            document.getElementById(`quiz-result-${qIdx}`).classList.remove('hidden');
            document.getElementById(`quiz-score-${qIdx}`).innerText = `${state.score}/${total}`;
        }

        function resetQuiz(qIdx) {
            document.getElementById(`quiz-result-${qIdx}`).classList.add('hidden');
            document.getElementById(`quiz-container-${qIdx}`).classList.add('hidden');
            document.getElementById(`quiz-start-${qIdx}`).classList.remove('hidden');
        }

        function renderModules() {
            document.getElementById('module-grid').innerHTML = modules.map(m => `
                <div onclick="openModule('${m.id}')" class="module-card bg-white p-6 rounded-2xl shadow-sm border border-slate-200 cursor-pointer hover:shadow-md transition">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-4 bg-${m.color}-100 text-${m.color}-600"><i data-lucide="${m.icon}"></i></div>
                    <h3 class="font-bold text-lg mb-2">AZ-104: ${m.name}</h3>
                    <p class="text-slate-500 text-sm leading-relaxed">${m.desc}</p>
                    <div class="mt-4 flex items-center text-xs font-bold text-indigo-600 gap-1 uppercase tracking-wide">Study Domain <i data-lucide="chevron-right" class="w-3 h-3"></i></div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function flipAllCards() {
            const cards = document.querySelectorAll('.flashcard-container');
            const isAnyNotFlipped = Array.from(cards).some(c => !c.classList.contains('flipped'));
            cards.forEach(c => isAnyNotFlipped ? c.classList.add('flipped') : c.classList.remove('flipped'));
        }

        window.onload = () => { renderModules(); };
    </script>
</body>
</html>
